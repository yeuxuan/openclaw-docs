# 44 核心重点功能标记与遗漏补齐

这篇是“总检查单”。  
目标：把真正影响你复刻项目成败的核心功能，按优先级标记出来，并明确此前文档的遗漏点是否已补齐。

## 步骤一：核心重点功能标记（按优先级）

### P0（必须先掌握，不然系统跑不稳）

1. 连接与权限主链
- `src/gateway/server/ws-connection/message-handler.ts`
- `src/gateway/server-methods.ts`

2. 智能体执行主链
- `src/auto-reply/reply/agent-runner-execution.ts`
- `src/agents/pi-embedded-runner/run.ts`
- `src/agents/pi-embedded-runner/run/attempt.ts`

3. 通道适配器框架与账号生命周期
- `src/channels/plugins/types.plugin.ts`
- `src/plugins/registry.ts`
- `src/gateway/server-channels.ts`
- `src/infra/outbound/deliver.ts`

4. 会话与并发隔离
- `src/gateway/server-methods/sessions.ts`
- `src/process/command-queue.ts`
- `src/agents/pi-embedded-runner/lanes.ts`

5. 网关 HTTP 面入口
- `src/gateway/server-http.ts`
- `src/gateway/openai-http.ts`
- `src/gateway/openresponses-http.ts`

### P1（稳定性与可运维能力）

1. 配置热重载与重启判定
- `src/gateway/config-reload.ts`
- `src/gateway/server-reload-handlers.ts`

2. 优雅关停与重启续接
- `src/gateway/server-close.ts`
- `src/gateway/server-restart-sentinel.ts`
- `src/infra/restart-sentinel.ts`

3. 远端节点体系
- `src/gateway/node-registry.ts`
- `src/gateway/server-methods/nodes.ts`

### P2（扩展与生态接入）

1. Hook 与外部系统接入
- `src/gateway/hooks.ts`
- `src/gateway/server/hooks.ts`

2. HTTP 工具调用入口
- `src/gateway/tools-invoke-http.ts`

3. 协议 schema 层
- `src/gateway/protocol/schema/*`

## 状态更新（已补齐）

上述核心模块已补齐到：
- `45-函数级剖析-server-runtime-config.md`
- `46-函数级剖析-server-tailscale.md`
- `47-函数级剖析-server-discovery-runtime.md`
- `48-函数级剖析-server-lanes.md`
- `49-函数级剖析-server-model-catalog.md`
- `50-函数级剖析-server-session-key.md`
- `51-函数级剖析-server-startup-memory.md`
- `52-函数级剖析-exec-approval-manager.md`
- `53-函数级剖析-通道适配器框架实现.md`


